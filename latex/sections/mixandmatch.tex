\section{}

~\textbf{Alice:} can call loadFunds more than once. loadCiphertexts  x 4

~\textbf{Bob:} can call loadFunds more than once. loadCiphertexts x 4

~\textbf{Trustee1:} is also the manager. Trustee1 calls  
\begin{enumerate}
	\item loadOutputs  x 2
	\item  createRow1  x 4
\end{enumerate}
at the beginning of the protocol. 
\newline

The following is repeated for each PET (8 times): 
\begin{enumerate}
	\item PET\_subtract
	\item DHProve\_Trustee1Pf\_Rand
	\item DHProve\_Trustee1Pf\_PartialDec
	 \item FullDecryption
\end{enumerate}

After all PETs are run, Trustee1 has to run the following:
\begin{enumerate}
	\item matchingRow
	\item matchingValue
	\item createFinalDecryption
	\item loadFinalCiphertext
	\item DHProve\_Trustee1Pf\_PartialDec
	\item FullDecryption
\end{enumerate}

~\textbf{Trustee2:} 

The following is repeated for each PET (8 times): 
\begin{enumerate}
	\item DHProve\_Trustee2Pf\_Rand 
	\item DHProve\_Trustee2Pf\_PartialDec
\end{enumerate}
and calls DHProve\_Trustee2Pf\_PartialDec once for the final decryption.


\begin{table}[]
	\begin{tabular}{|l|l|l|l|}
		\hline
		Contract & Function  & Gas  & Gas Cost (\$)  \\ \hline
		\multirow{9}{*}{}  
		& loadFund & 28040  &1.50  \\ \cline{2-4} 
		& checkBalances &  30359& 1.63 \\  \cline{2-4} 
		&  loadOutputs&  300798 & 16.13 \\  \cline{2-4} 
		&  createRow1 & 8741453 & 468.90 \\  \cline{2-4}
		Mixmatch.sol	&  matchingRow & 37547 &2.01  \\  \cline{2-4}
		& matchingValue &  40868&2.19 \\  \cline{2-4}
		&  createFinalDecryption&  4430611& 237.66 \\  \cline{2-4}
		& sendexcessfunds &  41110& 2.21 \\  \cline{2-4}
		& withdraw &  39221& 2.10 \\   \hline
		\multirow{8}{*}{} 
		&  loadCiphertexts & 304668 & 16.34 \\  \cline{2-4}
		& PET\_subtract & 242131 & 12.99\\  \cline{2-4}
		&  DHProve\_Trustee1Pf\_Rand& 815340 &  43.74\\  \cline{2-4}
		PET.sol	&  DHProve\_Trustee2Pf\_Rand& 393561 &21.11  \\  \cline{2-4}
		&  DHProve\_Trustee1Pf\_PartialDec& 364298 & 19.54\\  \cline{2-4}
		& DHProve\_Trustee2Pf\_PartialDec & 363612 & 19.50 \\  \cline{2-4}
		& FullDecryption  &  107086& 5.74 \\  \cline{2-4}
		&  loadFinalCiphertext& 173945 & 9.33\\ \hline
	\end{tabular}
	\caption{Table description!! (Gas on Dec 01, 2020 is 0.000000087210450983 ETH)} \label{tab:gas}
\end{table}


\begin{table}[]
	\begin{tabular}{|l|l|}
		\hline
		code	& Size(bytes)  \\ \hline
		bytecode	& 27178  \\ \hline
		deployed	& 26774  \\ \hline
		initialisation and constructor code 	& 404 \\ \hline
	\end{tabular}
\end{table}

\begin{table}[]
	\begin{tabular}{|l|l|l|l|l|}
		\hline
		& Alice &  Bob & Trustee1*  & Trustee2  \\ \hline
		Number of Transactions	& 5 &5  &44  &17  \\ \hline
		Total gas cost	& 1246712 &  1246712& 52952603  & 6420996 \\ \hline
		Total cost in USD	&  66.87& 66.87 &2840.41  & 344.43 \\ \hline
	\end{tabular}
\end{table}


\begin{mdframed}
 	\textbf{Mix and match}
 	\newline
 	 \newline
 	\textbf{Parties: } Alice, Bob, Trustee1 (who is also the manager), Trustee2 
 	 \newline
 	\textbf{Input: } Alice's ElGamal ciphertext, Bob's ElGamal ciphertext, encrypted NAND table 
 	\newline
 	\textbf{Output: } Matching value from the table based on Alice and Bob's inputs
 	\newline
 	
	Preparation stage for mix and match are done off-chain:
	\begin{enumerate}
		\item Manager creates the table for NAND gate with two inputs and encrypts each cell using ElGamal. 
		\item Manager shuffles the rows and rerandomizes the cells of the table.
		\item Alice and Bob encrypt their respective inputs $a$ and $b$ as $[a]$ and $[b]$.
	\end{enumerate}

 	The protocol continues as follows:
 	\begin{enumerate}
 		\item Alice and Bob deposit their ciphertexts, $[a]$ and $[b]$, into the smart contract. They also deposit enough funds into the contract. The funds will be used to compensate the work done by the trustees.
 		\item Trustee1 (Manager) subtracts user's (Alice or Bob) input from the cell's value.
 		\item Trustee1 submits blinded value and the values for zero knowledge proof (ZKP).
 		\item Trustee2 submits blinded value and the values for ZKP.
 		\item Trustee1 submits value for partial decryption and the values for ZKP.
 		\item Trustee2 submits value for partial decryption and the values for ZKP.
 		\item Trustee1 determines the matching row, partially decrypts the result and submits ZKP.
 		\item Trustee2  determines the matching result by partially decrypting Trustee1's result and submits ZKP.
 		\item Funds are transferred to the trustees.
 		\item Alice and Bob learn the final result.
 	\end{enumerate}
\end{mdframed}

Steps $2-6$ are repeated for each input cell.
